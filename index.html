<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="style.css"/>
  <script src="js/easeljs-0.5.0.min.js"></script>
  <script src="js/tweenjs-0.3.0.min.js"></script>
  <script>
    var stage;
    var marginTop = 30;
    var rightMomentum = 100;
    var freeFallLengthPercentage = .9;

    var winnerScore = 45;
    var looserScore = 33;

    var winnerX = 100;
    var winnerY = 400;

    function init(canvas) {
      stage = new createjs.Stage("scores");

      result(canvas, percentage(winnerScore, winnerScore), winnerX);
      result(canvas, percentage(looserScore, winnerScore), winnerY);

      createjs.Ticker.addListener(window);
      createjs.Ticker.setFPS(30);
      createjs.Ticker.useRAF = true;
    }

    function result(canvas, score, x) {
      var capsule = new createjs.Bitmap("png/codestory_blank_capsule_100.png");
      capsule.scaleX = 0.75;
      capsule.scaleY = 0.75;
      var y = bottomY(capsule, canvas);
      var topCapsuleHeight = y - score * y / 100 + marginTop;
      capsule.x = x - realWidth(capsule) / 2 + 5;
      capsule.y = y;
      createjs.Tween.get(capsule, {})
              .to({y:topCapsuleHeight}, 2500, createjs.Ease.cubicInOut);

      var cosmonaut = new createjs.Bitmap("png/codestory_spaceman_100.png");
      cosmonaut.scaleX = 0.25;
      cosmonaut.scaleY = 0.25;
      cosmonaut.x = x - realWidth(cosmonaut) / 2;
      cosmonaut.y = y + 155;
      var endOfFreeFall = bottomY(cosmonaut, canvas) - Math.floor(canvas.height * (1 - freeFallLengthPercentage));
      createjs.Tween.get(cosmonaut, {})
              .to({y:topCapsuleHeight + 155}, 2500, createjs.Ease.cubicInOut)
              .to({y:endOfFreeFall}, 1000, createjs.Ease.backIn)
              .to({y:bottomY(cosmonaut, canvas)}, 3000, createjs.Ease.sineInOut);
      createjs.Tween.get(cosmonaut, {})
              .wait(2500)
              .to({x:cosmonaut.x + rightMomentum}, 1000, createjs.Ease.circOut);

      var parachute = new createjs.Bitmap("png/codestory_blank_parachute_200.png");
      parachute.scaleX = 0.25;
      parachute.scaleY = 0.25;
      parachute.x = x - realWidth(parachute) / 2 + rightMomentum;
      parachute.y = endOfFreeFall - realHeight(parachute);
      parachute.visible = false;
      createjs.Tween.get(parachute, {})
              .wait(3500)
              .set({visible:true}, parachute)
              .to({y:bottomY(parachute, canvas) - realHeight(cosmonaut)}, 3000, createjs.Ease.sineInOut)
              .wait(100)
              .set({visible:false}, parachute);

      stage.addChild(cosmonaut);
      stage.addChild(parachute);
      stage.addChild(capsule);
    }

    function tick(elapsedTime) {
      stage.update(elapsedTime);
    }

    function realWidth(bitmap) {
      return Math.floor(bitmap.image.width * bitmap.scaleX);
    }

    function realHeight(bitmap) {
      return Math.floor(bitmap.image.height * bitmap.scaleY);
    }

    function bottomY(bitmap, canvas) {
      return canvas.height - realHeight(bitmap);
    }

    function percentage(actualValue, maximumValue) {
      return actualValue * 100 / maximumValue;
    }

  </script>
</head>
<body onload="init(document.getElementById('scores'));">
<canvas id="scores" width="1006" height="566">
  scores
</canvas>
</body>
</html>